CREATE SCHEMA ta;

CREATE TYPE ta.business_type AS ENUM ('HOTEL', 'BAR', 'RESTAURANT');

CREATE TABLE ta.businesses (
   id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1),
   name VARCHAR(50) NOT NULL,
   city VARCHAR(50) NOT NULL,
   business_type ta.business_type NOT NULL,
   average_rating DOUBLE PRECISION DEFAULT 0,
   number_of_reviews INT DEFAULT 0,
   address VARCHAR(150),
   email VARCHAR(30),
   phone VARCHAR(20),
   website VARCHAR(30),
   CONSTRAINT unique_business UNIQUE (name, city)
);


CREATE TABLE ta.users (
   id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1),
   username VARCHAR(50) NOT NULL,
   email VARCHAR(50) NOT NULL,
   first_name VARCHAR(50) NOT NULL,
   last_name VARCHAR(50) NOT NULL,
   city VARCHAR(50) NOT NULL,
   joining_date DATE,
   CONSTRAINT unique_username UNIQUE (username),
   CONSTRAINT unique_email UNIQUE (email)
);


CREATE TYPE ta.review_rating AS ENUM ('VERY_POOR', 'POOR', 'AVERAGE', 'GOOD', 'VERY_GOOD');

CREATE TABLE ta.review (
   id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1),
   username VARCHAR(50) NOT NULL,
   stamp_created DATE,
   rating ta.review_rating NOT NULL,
   text_body TEXT,
   business_id BIGINT NOT NULL,
   FOREIGN KEY (username) REFERENCES ta.users (username)
);

CREATE USER dobrin WITH PASSWORD 'dobrin12345';
GRANT ALL ON SCHEMA ta TO dobrin;
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE ta.review TO dobrin;
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE ta.users TO dobrin;
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE ta.businesses TO dobrin;




 